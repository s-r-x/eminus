name: CI/CD
on:
  push:
    branches: ['main']
    # paths:
    #   ['src/stories/**', 'src/components/**', 'src/styles/**', '.storybook/**']
env:
  CYPRESS_CACHE_FOLDER: cypress/cache

jobs:
  lint:
    name: lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '16.4'
      - name: Cache dependencies
        id: npm_cache
        uses: actions/cache@v2
        with:
          path: ./node_modules
          key: depsV1-${{ hashFiles('package-lock.json') }}
      - name: Cache cypress
        id: cache-cypress
        uses: actions/cache@v2
        with:
          path: cypress/cache
          key: cypress-cache-${{ hashFiles('package-lock.json') }}
      - name: Install dependencies
        if: steps.npm_cache.outputs.cache-hit != 'true'
        run: npm ci
      - name: Eslint
        run: npm run lint.strict
      - name: Build
        run: npm run build
      - name: Unit tests
        run: npm run test.unit
      - name: Browser tests
        run: npm run test.browser
  # build-and-deploy:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout üõéÔ∏è
  #       uses: actions/checkout@v2.3.1
  #       with:
  #         persist-credentials: false
  #     - name: Install and Build üîß
  #       run: |
  #         npm ci
  #         npm run storybook.build
  #     - name: Deploy üöÄ
  #       uses: JamesIves/github-pages-deploy-action@4.1.5
  #       with:
  #         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  #         BRANCH: main
  #         FOLDER: storybook-static
  #         CLEAN: true
  #         TARGET_FOLDER: docs
